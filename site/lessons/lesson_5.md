
```markdown
# Введение в tidyverse и dplyr в R

## 📌 Что такое `tidyverse`?

**`tidyverse`** — это набор пакетов для анализа и обработки данных в R. Он разработан, чтобы упростить работу с таблицами и сделать код **более читаемым и удобным**.

### 🔥 Почему стоит использовать `tidyverse`?

✅ Упрощает работу с данными  
✅ Минимум сложных конструкций `base R`  
✅ Поддержка пайпов (`%>%`), что делает код читаемым  
✅ Функции интуитивно понятны и легко запоминаются  
✅ Хорошая документация и поддержка сообщества  

### 📦 Как установить и загрузить `tidyverse`?

Устанавливаем весь пакет:
```r
install.packages("tidyverse")
```

Загружаем `tidyverse` в R:
```r
library(tidyverse)
```

После загрузки мы получаем доступ к нескольким ключевым пакетам, но сейчас мы сосредоточимся только на **`dplyr`**.

---

## 🚀 dplyr: Основные функции для работы с таблицами

**`dplyr`** предназначен для удобной работы с табличными данными (`data.frame` и `tibble`). Он включает несколько ключевых функций, каждая из которых выполняет **одно действие**.

### 🔑 Основные функции `dplyr`

| Функция       | Описание |
|--------------|----------|
| `select()`   | Выбирает нужные колонки |
| `filter()`   | Оставляет только нужные строки по условию |
| `mutate()`   | Создает или изменяет колонки |
| `arrange()`  | Сортирует строки |
| `group_by()` | Группирует данные |
| `summarise()` | Считает статистики по группам |
| `count()`    | Подсчитывает количество строк |
| `rename()`   | Переименовывает колонки |
| `relocate()` | Меняет порядок колонок |

---

## 🔹 `select()`: Выбор колонок

Функция **`select()`** позволяет выбрать только те колонки, которые нужны.

📌 **Пример:** Выбираем колонки `mpg` (расход топлива) и `hp` (мощность) из `mtcars`:

```r
mtcars %>% 
  select(mpg, hp)
```

### 🛠 Дополнительные возможности `select()`
- Выбирать колонки по индексу:
  ```r
  mtcars %>% select(1, 4)
  ```
- Исключать колонки (`-` перед названием):
  ```r
  mtcars %>% select(-c(mpg, hp))
  ```
- Выбирать диапазон колонок:
  ```r
  mtcars %>% select(mpg:hp)
  ```
- Выбирать по шаблону (например, все колонки, начинающиеся на "cyl"):
  ```r
  mtcars %>% select(starts_with("cyl"))
  ```

---

## 🔹 `filter()`: Фильтрация строк по условию

Функция **`filter()`** оставляет только строки, которые соответствуют заданному условию.

📌 **Пример:** Выбираем автомобили с мощностью (`hp`) больше 100:

```r
mtcars %>% 
  filter(hp > 100)
```

### 🛠 Комбинирование условий в `filter()`
- Несколько условий (логическое `И` – `&`):
  ```r
  mtcars %>% filter(hp > 100 & mpg < 20)
  ```
- Логическое `ИЛИ` (`|`):
  ```r
  mtcars %>% filter(hp > 200 | mpg > 30)
  ```
- Проверка наличия в списке:
  ```r
  mtcars %>% filter(cyl %in% c(4, 6)) # Только 4- и 6-цилиндровые машины
  ```

---

## 🔹 `mutate()`: Создание новых колонок

Функция **`mutate()`** добавляет или изменяет колонки в таблице.

📌 **Пример:** Создаем новую колонку `power_to_weight`, которая показывает соотношение мощности к весу:

```r
mtcars %>% 
  mutate(power_to_weight = hp / wt)
```

### 🛠 Продвинутые приемы `mutate()`
- Изменение существующей колонки:
  ```r
  mtcars %>% mutate(hp = hp * 2) # Увеличиваем мощность в 2 раза
  ```
- Условное создание новой колонки:
  ```r
  mtcars %>% mutate(type = if_else(hp > 100, "Мощный", "Слабый"))
  ```

---

## 🔹 `arrange()`: Сортировка строк

Функция **`arrange()`** позволяет отсортировать строки таблицы.

📌 **Пример:** Сортируем `mtcars` по расходу топлива (`mpg`) по возрастанию:

```r
mtcars %>% 
  arrange(mpg)
```

### 🛠 Дополнительные возможности `arrange()`
- Сортировка по убыванию (`desc()`):
  ```r
  mtcars %>% arrange(desc(mpg))
  ```
- Сортировка по нескольким колонкам:
  ```r
  mtcars %>% arrange(desc(hp), mpg)
  ```

---

## 🔹 `group_by()` + `summarise()`: Группировка и агрегация данных

Часто нужно посчитать средние, суммы или другие статистики по группам.  
Используем **`group_by()`** (группировка) + **`summarise()`** (подсчет статистики).

📌 **Пример:** Посчитаем среднюю мощность (`hp`) для каждой группы цилиндров (`cyl`):

```r
mtcars %>% 
  group_by(cyl) %>% 
  summarise(avg_hp = mean(hp, na.rm = TRUE))
```

### 🛠 Полезные функции в `summarise()`
- `mean()` – среднее значение  
- `median()` – медиана  
- `sd()` – стандартное отклонение  
- `n()` – количество строк в группе  

📌 **Пример:** Добавим количество машин (`n()`) в каждой группе:

```r
mtcars %>% 
  group_by(cyl) %>% 
  summarise(avg_hp = mean(hp), count = n())
```

---

## 🔹 `count()`: Подсчет количества строк

Если нужно быстро узнать, сколько строк в каждой группе, можно использовать **`count()`**.

📌 **Пример:** Посчитаем количество машин для каждой группы цилиндров (`cyl`):

```r
mtcars %>% 
  count(cyl)
```

---

## 🔹 `rename()`: Переименование колонок

Функция **`rename()`** позволяет изменить названия колонок.

📌 **Пример:** Переименуем `mpg` в `mileage`:

```r
mtcars %>% 
  rename(mileage = mpg)
```

---

## 🔹 `relocate()`: Перемещение колонок

Функция **`relocate()`** позволяет поменять порядок колонок.

📌 **Пример:** Переместим `hp` в начало:

```r
mtcars %>% 
  relocate(hp, .before = mpg)
```

```
